import json
from lxml import etree
from os import path
import re
import pandas as pd
def parse_rating(rating_str):
    res = re.findall(r"Rated (.*?) out of (\d+)", rating_str)[0]
    return float(res[0]) / float(res[1])
data = "[null,[[[40.7828647,-73.9653551]\n,\"0x89c2589a018531e3:0xb9df1f7387a94119\",\"Central Park\",\"Urban oasis with ballfields \\u0026 a zoo\",0,\"/m/09c7v\",null,null,\"13393458397880860953\"]\n,[[40.6892494,-74.04450039999999]\n,\"0x89c25090129c363d:0x40c6a5770d25022b\",\"Statue of Liberty\",\"American icon in New York Harbor\",0,\"/m/072p8\",null,null,\"4667599994556318251\"]\n,[[40.7484405,-73.98566439999999]\n,\"0x89c259a9b3117469:0xd134e199a405a163\",\"Empire State Building\",\"103-story landmark with observatories\",0,\"/m/02nd_\",null,null,\"15074921902713971043\"]\n,[[40.7060855,-73.9968643]\n,\"0x89c25a2343ce7b2b:0x2526ddba7abd465c\",\"Brooklyn Bridge\",\"Landmark 19th-century bridge\",0,\"/m/0cv4c\",null,null,\"2677070821511218780\"]\n,[[40.758894999999995,-73.985131]\n,\"0x89c25855c6480299:0x55194ec5a1ae072e\",\"Times Square\",\"Bright lights \\u0026 Broadway shows\",0,\"/m/07qdr\",null,null,\"6132018978369701678\"]\n,[[40.747992499999995,-74.0047649]\n,\"0x89c259c7840fb4e5:0x583f615c850a3c91\",\"High Line\",\"Park built into old elevated rail line\",0,\"/m/07jwwf\",null,null,\"6358908248867355793\"]\n,[[40.7587402,-73.9786736]\n,\"0x89c258fecf664df5:0x33d224a0d5dacca2\",\"Rockefeller Center\",\"Iconic Midtown business complex\",0,\"/m/0163ff\",null,null,\"3734087314244816034\"]\n,[[40.7794366,-73.963244]\n,\"0x89c25896f660c26f:0x3b2fa4f4b6c6a1fa\",\"Metropolitan Museum of Art\",\"World-class art collection\",0,\"/m/09c7b\",null,null,\"4264808743088595450\"]\n,[[40.7127431,-74.0133795]\n,\"0x89c25a197c06b7cb:0x40a06c78f79e5de6\",\"One World Trade Center\",\"Dining \\u0026 drinks on the 101st floor\",0,\"/m/0czc1h\",null,null,\"4656841281507319270\"]\n,[[40.7527262,-73.9772294]\n,\"0x89c25a21fb011c85:0x37513b7f1821408b\",\"Grand Central Terminal\",\"Architectural landmark \\u0026 transit hub\",0,\"/m/01rz3c\",null,null,\"3986032562251317387\"]\n,[[40.7614327,-73.97762159999999]\n,\"0x89c258f97bdb102b:0xea9f8fc0b3ffff55\",\"Museum of Modern Art\",\"World-class sculpture, art \\u0026 design\",0,\"/m/0hhjk\",null,null,\"16906389583988522837\"]\n,[[40.7032775,-74.0170279]\n,\"0x89c25a12f88ba2ad:0xbe70465e98439c12\",\"The Battery\",\"Waterfront park with harbor views\",0,\"/m/04sr12\",null,null,\"13722545436693339154\"]\n,[[40.7535965,-73.9832326]\n,\"0x89c259aae7a0b1bd:0xb49cafb82537f1a7\",\"Bryant Park\",\"4 acre urban oasis\",0,\"/m/03vgd_\",null,null,\"13014470228627157415\"]\n,[[40.7813241,-73.9739882]\n,\"0x89c258f4b00f7a09:0xa27d8172624c5db1\",\"American Museum of Natural History\",\"Historic museum of natural wonders\",0,\"/m/023r9j\",null,null,\"11708656934508584369\"]\n,[[40.7516208,-73.97550199999999]\n,\"0x89c2590247c56379:0x15e13bea38b43e18\",\"Chrysler Building\",\"1930s art deco tower with a storied past\",0,\"/m/01zmd\",null,null,\"1576607221716106776\"]\n,[[40.5755438,-73.9707016]\n,\"0x89c24448979d75cb:0x54745adc3c8f1179\",\"Coney Island\",\"Amusement park, lively boardwalk \\u0026 beach\",0,\"/m/013r41\",null,null,\"\"]\n,[[40.7829796,-73.9589706]\n,\"0x89c258a29a5e9e99:0x4a01c8df6fb3cb8\",\"Solomon R. Guggenheim Museum\",\"Modern art museum with a notable design\",0,\"/m/0q9h2\",null,null,\"333297768485043384\"]\n,[[40.715750899999996,-73.9970307]\n,\"0x89c259f56c2fc10d:0xcf9e1370cd1f3111\",\"Chinatown\",\"Asian dining, fish markets \\u0026 Tai Chi\",0,\"/m/0pnb8\",null,null,\"\"]\n,[[40.7308228,-73.997332]\n,\"0x89c25990e23d7e8d:0xfa615edfd1b67e18\",\"Washington Square Park\",\"Storied Greenwich Village gathering spot\",0,\"/m/037sn_\",null,null,\"18041805897612033560\"]\n,[[40.7584653,-73.97599269999999]\n,\"0x89c258fc102f6e51:0x88603435e036aa5b\",\"St. Patrick's Cathedral\",\"Iconic church with storied history\",0,\"/m/01kht3\",null,null,\"9826911792922012251\"]\n,[[40.6602037,-73.9689558]\n,\"0x89c25b1087680443:0x178bf7c600df7a98\",\"Prospect Park\",\"City green space with basketball courts\",0,\"/m/01s7jw\",null,null,\"1696722114425354904\"]\n,[[40.7505045,-73.9934387]\n,\"0x89c25a21fb011c85:0x33df10e49762f8e4\",\"Madison Square Garden\",\"Iconic venue for sports, concerts \\u0026 more\",0,\"/m/0j_66\",null,null,\"3737724789719234788\"]\n,[[40.677935,-74.040294]\n,\"0x89c2506fd1e58a65:0x1a02a2426283921\",\"Staten Island Ferry\",\"Harbor\",0,\"/m/01rxr7\",null,null,\"\"]\n,[[40.767778,-73.9718335]\n,\"0x89c258f1fcd66869:0x65d72e84d91a3f14\",\"Central Park Zoo\",\"Small zoo with penguins \\u0026 sea lions\",0,\"/m/04h9fs\",null,null,\"7338385265936449300\"]\n,[[40.8505949,-73.8769982]\n,\"0x89c2f483516ad28b:0x56eb41c9795102e\",\"Bronx Zoo\",\"Large urban zoo\",0,\"/m/0mzkb\",null,null,\"391448252523024430\"]\n,[[40.667621,-73.963189]\n,\"0x89c25b0e68bf8bc1:0x57422fe45b635cda\",\"Brooklyn Botanic Garden\",\"52-acre urban oasis\",0,\"/m/01rxnm\",null,null,\"6287640687594921178\"]\n,[[40.759243,-73.979294]\n,\"0x89c258ff31cabb7b:0xda17e23e0f1fc620\",\"Top of The Rock\",\"Rockefeller Center observation deck\",0,\"/g/11cmgnblyq\",null,null,\"15715278180902225440\"]\n,[[40.711801099999995,-74.0131196]\n,\"0x89c25a1a27c4829b:0x6ccc3ccd998e8b1d\",\"World Trade Center site\",\"Santiago Calatrava and monument\",0,\"/m/0hpjf\",null,null,\"\"]\n,[[40.759975999999995,-73.9799772]\n,\"0x89c258f8d61b2f3d:0x92c4e681d9aada95\",\"Radio City Music Hall\",\"Legendary theater, home of the Rockettes\",0,\"/m/016xm_\",null,null,\"10575831270349789845\"]\n,[[40.6895453,-74.0449292]\n,\"0x89c2508ed1e8d553:0x79084fab31e7ed6c\",\"Liberty Island\",\"Sculpture and monument\",0,\"/m/026kp2\",null,null,\"\"]\n,[[40.764526599999996,-73.99960759999999]\n,\"0x89c2584ed560199f:0x22362b652743ff1\",\"Intrepid Sea, Air \\u0026 Space Museum\",\"Flight museum on an aircraft carrier\",0,\"/m/02ysxf\",null,null,\"154075347467649009\"]\n,[[40.8648628,-73.9317274]\n,\"0x89c2f40170f2a62b:0x9191e7fa95df29ad\",\"The Cloisters\",\"Medieval art in a rebuilt monastery\",0,\"/m/01rs7b\",null,null,\"10489420070564866477\"]\n,[[40.753182300000006,-73.9822534]\n,\"0x89c2590099a8a8a9:0x3b51df6e509a734c\",\"New York Public Library\",\"Flagship branch in Beaux Arts building\",0,\"/m/01hyd9\",null,null,\"4274443186243007308\"]\n,[[40.7191413,-73.9973273]\n,\"0x89c2598845057def:0x9ecf1b969fbbb484\",\"Little Italy\",\"Italian dining, bakeries \\u0026 souvenirs\",0,\"/m/01nbpn\",null,null,\"\"]\n,[[40.7724641,-73.9834889]\n,\"0x89c258f55fbea537:0x49d5f074061cac4e\",\"Lincoln Center for the Performing Arts\",\"Premier New York City arts complex\",0,\"/m/01dzs9\",null,null,\"5320422915917524046\"]\n,[[40.6215489,-74.06524379999999]\n,\"0x89c2507b5e8c9d09:0x7e5b091171425498\",\"New York Harbor\",\"Harbor, sailing, river, and history\",0,\"/m/01pdsd\",null,null,\"\"]\n,[[40.7651258,-73.97992359999999]\n,\"0x89c258f7785411d9:0x3d14b15e5c7a9477\",\"Carnegie Hall\",\"World-renowned classical music hall\",0,\"/m/016p8t\",null,null,\"4401337754684396663\"]\n,[[40.771209,-73.9673991]\n,\"0x89c258eceefd111d:0xd88ef5290f5e20e8\",\"Frick Collection\",\"Art museum in a Fifth Avenue mansion\",0,\"/m/021848\",null,null,\"15604679315585638632\"]\n,[[40.7395877,-74.0088629]\n,\"0x89c25894ea097337:0xc63f52f9d53d7889\",\"Whitney Museum of American Art\",\"Museum with 20th \\u0026 21st-century art\",0,\"/m/0hhj3\",null,null,\"14285227776020412553\"]\n,[[40.718795799999995,-73.99006969999999]\n,\"0x89c2598725d546db:0xcd60e6fdb0de8e84\",\"Lower East Side Tenement Museum\",\"Preserved immigrant home from 1863\",0,\"/m/08l3dr\",null,null,\"14799082352807939716\"]\n,[[40.810018,-73.95005600000002]\n,\"0x89c2f66d3282a545:0x1ccd9839e39cdc2d\",\"Apollo Theater\",\"Legendary Harlem performance hall\",0,\"/m/020nlt\",null,null,\"2075482377686932525\"]\n,[[40.741060499999996,-73.9896986]\n,\"0x89c259a3f71c1f67:0xde2a6125ed704926\",\"Flatiron Building\",\"Landmark triangular 22-story building\",0,\"/m/01lnd3\",null,null,\"16008714640967092518\"]\n,[[40.8644916,-73.8831988]\n,\"0x89c2f37cb80715c9:0xd73f5ca83441153f\",\"New York Botanical Garden\",\"Bronx garden refuge covering 250 acres\",0,\"/m/0209mm\",null,null,\"15510217519188219199\"]\n,[[40.700291299999996,-73.99669949999999]\n,\"0x89c25a46a369a18d:0xa109779d5185c305\",\"Brooklyn Bridge Park\",\"Riverfront BBQ grills \\u0026 shaded seating\",0,\"/m/0265hxz\",null,null,\"11603937432458085125\"]\n,[[40.7421706,-74.0050918]\n,\"0x89c259bf144c69c3:0x7e61762e972dc0a2\",\"Chelsea Market\",\"Shops, eateries \\u0026 more in bustling space\",0,\"/m/0bwbh0\",null,null,\"9106689863996784802\"]\n,[[40.7644691,-73.9744877]\n,\"0x89c258f07d5da561:0x61f6aa300ba8339d\",\"Plaza Hotel\",\"Landmark luxury hotel with posh dining\",0,\"/m/042y7j\",null,null,\"7059016589280555933\"]\n,[[40.7488758,-73.9680091]\n,\"0x89c2591ce0874d11:0xc5fae28bdd3df635\",\"United Nations Headquarters\",\"Home of the international organization\",0,\"/m/019vsd\",null,null,\"14265963859989624373\"]\n,[[40.76050310000001,-73.9509934]\n,\"0x89c258c4d85a0d8d:0x11f877ff0b8ffe27\",\"Roosevelt Island\",\"Franklin D. Roosevelt and lighthouse\",0,\"/m/0dp3v\",null,null,\"\"]\n,[[40.6983718,-73.9881451]\n,\"0x89c25a3a68c3e995:0x16770ff7c9241e0c\",\"Brooklyn Bridge\",\"\",0,\"/g/1tk640vm\",null,null,\"\"]\n,[[40.705553699999996,-74.0134436]\n,\"0x89c2589a17a81551:0xc7db393ae1eff521\",\"Charging Bull\",\"Popular bronze statue \\u0026 financial icon\",0,\"/m/029g0_\",null,null,\"14401167158508778785\"]\n]\n]\n"
vals = json.loads(data)[1]
latlngs = {i[2]: i[0] for i in vals}
city = 'NewYork'
html = etree.parse('attractions/{}.html'.format(city), etree.HTMLParser())
listings = html.xpath('//div[@class="_EAm _f5v"]')
data = []
for listing in listings:
    name = listing.xpath('.//h2[@class="_Qzm"]/text()')[0]
    try:
        rating_str = (listing.xpath('.//span[@class="_pxg _Jxg"]/@aria-label')[0])
        rating = parse_rating(rating_str)
    except IndexError:
        rating = 0
    try:
        reviews_str = listing.xpath('.//span[@class="_Mnc _yz"]/@aria-label')[0]
        reviews = int(reviews_str.split(' ')[0].replace(',', ''))
    except IndexError:
        reviews = 0
    if name not in latlngs:
        raise Exception("{} has no latlngs".format(name))
    item = {"Name": name, "Latitude": latlngs[name][0], "Longitude": latlngs[name][1], "Rating": rating, "Reviews": reviews}
    data.append(item)
df = pd.DataFrame(data)
df.to_csv(path.join('attractions', city + ".csv"))